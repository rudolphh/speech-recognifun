<html>
  <head> </head>
  <body>
    <div class="words"></div>
    <h2>Search results for:</h2>
    <div id="search-input"></div>
    <h3 id="viewing"></h3>

    <div id="search-nav-top" class="search-nav search-nav-top"></div>
    <div id="results-list" class="search-results-list list-container"></div>
    <div id="search-nav-bottom" class="search-nav search-nav-bottom"></div>

    <script src="./colors.js"></script>
    <script src="http://cdn.scripture.api.bible/fums/fumsv2.min.js"></script>
    <script src="./bibleApiSearch.js"></script>
    <script>
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.interimResults = true;

      let p = document.createElement("p");
      const words = document.querySelector(".words");
      words.appendChild(p);

      recognition.addEventListener("result", (e) => {
        //console.log(e.results);
        const transcript = Array.from(e.results)
          .map((result) => result[0])
          .map((result) => result.transcript)
          .join("");

        p.textContent = transcript;

        if (e.results[0].isFinal) {
          //p = document.createElement("p");
          //words.appendChild(p);

          let spokenColors = transcript.split(' ').filter((word) => CSS_COLOR_NAMES.includes(word.charAt(0).toUpperCase() + word.slice(1)));
          document.body.style.backgroundColor = spokenColors[spokenColors.length-1];

          if(transcript.includes("Rudy")){ 
            var baseUrl = 'https://www.google.com/search?q=';
            let searchIndex = transcript.lastIndexOf("Rudy") + 5;// ignore name plus a space
            //console.log(searchIndex)
            let query = transcript.substring(searchIndex);
            //console.log("field: " + searchField);

            // encode only the query string
            let completeUrl = baseUrl + encodeURIComponent(query)
            console.log(completeUrl)
            window.open(completeUrl, "tab");
          }

          if(transcript.includes("Bible")) {
            let searchIndex = transcript.lastIndexOf("Bible") + 6;// ignore name plus a space
            //console.log(searchIndex)
            let query = transcript.substring(searchIndex);
            //console.log("field: " + searchField);

            search(query);
          }
        }

        console.log(transcript);
      });

      recognition.addEventListener("end", recognition.start);

      recognition.start();
    </script>
  </body>
</html>
