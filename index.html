<html>
  <head>
  <!-- CSS only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet" 
  integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
  <link rel="stylesheet" href="./assets/css/main.css">
  <link rel="stylesheet" href="./assets/css/scripture.css">

  <style>
    #search-input-label {
      display: inline-block;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    #search-nav-bottom {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .results-nav {
      padding: 20px;
    }
    .words {
      border: 1px solid lightgray;
      padding: 20px;
      border-radius: 10px;
    }
    .words p {
      font-size: 30px;
      border-bottom: 1px solid slategray;
    }

    #logo-container {
      text-align: center;
    }

    .vcin-logo {
      text-align: center;
      transition: max-height 1s ease-out;
      max-height: 600px;
    }

    .disappear {
      max-height: 0px;
    }


  </style>  
  </head>
  <body>
    <audio id="myAudio">
      <source src="./assets/sound/t1_be_back.wav" 
        type="audio/wav">
      Your browser does not support the audio element.
    </audio>
    
    <div class="container">
      <div class="words m-5">
      </div>
      <div id="logo-container"><img class="vcin-logo" src="./assets/img/vcinator.png" alt=""></div>
      <h4 id="search-input-label" style="display: none;">Search results for:</h4>
      <span id="search-input"></span>
      <h3 id="viewing"></h3>

      <div id="search-nav-top" class="search-nav search-nav-top"></div>
      <div id="results-list" class="search-results-list list-container"></div>
      <div id="search-nav-bottom" class="search-nav search-nav-bottom"></div>
    </div>

    <script src="./colors.js"></script>
    <script src="./assets/js/fumsv2.min.js"></script>
    <script src="./bibleApiSearch.js"></script>
    <script>
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.interimResults = true;

      let p = document.createElement("p");
      let small = document.createElement('small');
      p.textContent = "Voiceinator"
      small.innerHTML = 'Say a simple <strong>color</strong>, tell <strong>Rudy</strong> what to Google, or <strong>hey Bible</strong> to search scripture'
      small.innerHTML += `
      <small><div style="margin: 5px; font-weight: normal;">can also use: </div>
          <ul>
            <li><strong>hey YouTube </strong>&lt;search query&gt;</li>
            <li><strong>hey indeed </strong>&lt;'job title' in 'location'&gt;</li>
          </ul>
        </small>`;

      const words = document.querySelector(".words");
      words.appendChild(p);
      words.appendChild(small);

      recognition.addEventListener("result", (e) => {
        //console.log(e.results);
        const transcript = Array.from(e.results)
          .map((result) => result[0])
          .map((result) => result.transcript)
          .join("");

        p.textContent = transcript;

        if (e.results[0].isFinal) {
          //p = document.createElement("p");
          //words.appendChild(p);

          let spokenColors = transcript.split(' ').filter((word) => CSS_COLOR_NAMES.includes(word.charAt(0).toUpperCase() + word.slice(1)));
          document.body.style.backgroundColor = spokenColors[spokenColors.length-1];

          // "rudy"
          if(transcript.includes("Rudy")){ 
            let baseUrl = 'https://www.google.com/search?q=';
            let searchIndex = transcript.lastIndexOf("Rudy") + 5;// ignore name plus a space
            //console.log(searchIndex)
            let query = transcript.substring(searchIndex);
            //console.log("field: " + searchField);

            // encode only the query string
            let completeUrl = baseUrl + encodeURIComponent(query)
            console.log(completeUrl)
            window.open(completeUrl);
          }

          // "bible"
          if(transcript.includes("hey Bible")) {

            let searchIndex = transcript.lastIndexOf("Bible") + 6;// ignore name plus a space
            let query = transcript.substring(searchIndex);

            const beBack = document.getElementById("myAudio");
            const vcinLogo = document.querySelector('.vcin-logo');

            if(!vcinLogo.classList.contains('disappear')) {
              beBack.play();
              vcinLogo.classList.add('disappear');
              searchInputLabel.style.display = 'inline-block';
            }

            searchInput.innerHTML = query;
            search(encodeURIComponent(query));
          }

          // jobs
          let phrase = "hey indeed"
          if(transcript.toLowerCase().includes(phrase)) {
            let baseUrl = "https://www.indeed.com/jobs?q="
            let searchIndex = transcript.lastIndexOf(phrase) + phrase.length+1;
            let query = transcript.substring(searchIndex);

            let completeUrl = baseUrl + encodeURIComponent(query);

            console.log(completeUrl);
            window.open(completeUrl);
          }

          //youtube
          phrase = 'hey YouTube'
          if(transcript.includes(phrase)){ 
            let baseUrl = 'https://www.youtube.com/results?search_query=';
            let searchIndex = transcript.lastIndexOf(phrase) + phrase.length+1;
            let query = transcript.substring(searchIndex);

            // encode only the query string
            let completeUrl = baseUrl + encodeURIComponent(query)
            console.log(completeUrl)
            window.open(completeUrl);
          }

        }

        console.log(transcript);
      });

      recognition.addEventListener("end", recognition.start);

      recognition.start();
    </script>
  </body>
</html>
